machine:
  ghc:
    version: 7.10.1
checkout:
  post:
    - mkdir -p _site
    - mkdir -p _cache
    - aws s3 sync s3://expoundite.net/ _site
dependencies:
  cache_directories:
    - _site
    - _cache
  override:
    - cabal update
    - cabal sandbox init
    - cabal install --upgrade-dependencies --constraint="template-haskell installed" --dependencies-only --enable-tests --force-reinstall
  post:
    - cabal build
    - sudo pip install awscli
test:
  override:
    - dist/build/expoundite/expoundite build
    - ./retouch.sh
deployment:
  aws:
    branch: master
    commands:
      - ./publish.sh